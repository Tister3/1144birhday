<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>HAPPY BIRTHDAY –ù–ò–ö–ò–¢–ê 11.44 –ë–ò–õ–¨–Ø–†–î–ò–°–¢!!!</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; user-select: none; }

        /* === –ù–û–í–´–ô –ü–†–ò–¶–ï–õ (CSS) === */
        #crosshair {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); pointer-events: none; z-index: 50;
        }
        /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è */
        #crosshair::before {
            content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 24px; height: 2px; background: #00ff00; /* –Ø—Ä–∫–æ-–∑–µ–ª–µ–Ω—ã–π */
            box-shadow: 0 0 2px #000;
        }
        /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è */
        #crosshair::after {
            content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 2px; height: 24px; background: #00ff00;
            box-shadow: 0 0 2px #000;
        }

        /* === –û–†–£–ñ–ò–ï –í –†–£–ö–ê–• (Viewmodel) === */
        #weapon-container {
            position: absolute;
            bottom: 0; right: 0;
            width: 40%; /* –†–∞–∑–º–µ—Ä –æ—Ä—É–∂–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —ç–∫—Ä–∞–Ω–∞. –ú–æ–∂–µ—à—å –º–µ–Ω—è—Ç—å: 30% - 60% */
            max-width: 1500px;
            height: auto;
            z-index: 40; /* –ü–æ–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º, –Ω–æ –Ω–∞–¥ –∏–≥—Ä–æ–π */
            pointer-events: none; /* –ö–ª–∏–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å–∫–≤–æ–∑—å –∫–∞—Ä—Ç–∏–Ω–∫—É */
            overflow: hidden;
            display: flex; justify-content: flex-end; align-items: flex-end;
        }
        #weapon-img {
            width: 100%; height: auto; display: block;
            /* –ë–∞–∑–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è: –Ω–µ–º–Ω–æ–≥–æ —Å–¥–≤–∏–Ω—É—Ç–æ –≤–ø—Ä–∞–≤–æ –∏ –≤–Ω–∏–∑, —á—Ç–æ–±—ã –≤—ã–≥–ª—è–¥—ã–≤–∞–ª–æ –∏–∑-–∑–∞ —ç–∫—Ä–∞–Ω–∞ */
            transform: translate(15%, 15%);
            transition: transform 0.1s ease-out;
        }
        /* –ö–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–¥–∞—á–∏ */
        .recoil-anim {
            /* –ü—Ä–∏ –≤—ã—Å—Ç—Ä–µ–ª–µ –æ—Ä—É–∂–∏–µ —Ä–µ–∑–∫–æ —É—Ö–æ–¥–∏—Ç –Ω–∞–∑–∞–¥ –∏ –≤–≤–µ—Ä—Ö, –∏ —á—É—Ç—å –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è */
            transform: translate(25%, 25%) rotate(3deg) !important;
        }

        #ui-layer { position: absolute; top: 20px; left: 20px; color: #0f0; font-size: 24px; text-shadow: 2px 2px 0 #000; pointer-events: none; z-index: 60;}

        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥—Ä—É–∑–µ–π */
        .friend-msg {
            position: absolute; bottom: 30%; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: column; align-items: center;
            animation: popUp 3s forwards; pointer-events: none; z-index: 55;
        }
        .friend-avatar {
            width: 80px; height: 80px; background: #fff; border: 4px solid #0f0; image-rendering: pixelated;
            margin-bottom: 10px; background-size: cover; box-shadow: 0 0 10px #0f0;
        }
        .friend-text { background: rgba(0,0,0,0.7); color: #fff; padding: 10px; border-radius: 8px; font-weight: bold; font-size: 20px; text-transform: uppercase; }

        @keyframes popUp {
            0% { opacity: 0; transform: translate(-50%, 50px) scale(0.8); }
            10% { opacity: 1; transform: translate(-50%, 0) scale(1.1); }
            20% { transform: translate(-50%, 0) scale(1); }
            80% { opacity: 1; }
            100% { opacity: 0; transform: translate(-50%, -100px); }
        }

        /* –≠–∫—Ä–∞–Ω –ø–æ–±–µ–¥—ã */
        #win-screen {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); flex-direction: column; align-items: center; justify-content: center;
            color: #fff; z-index: 100;
        }
        input { padding: 15px; font-size: 18px; width: 300px; margin: 20px; text-align: center; background: #222; border: 2px solid #0f0; color: #fff; outline: none; }
        button { padding: 15px 30px; font-size: 18px; cursor: pointer; background: #0f0; border: none; font-weight: bold; color: #000; transition: 0.2s;}
        button:hover { background: #fff; box-shadow: 0 0 15px #0f0; }

        #start-screen {
            display: flex; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; color: #0f0; align-items: center; justify-content: center; flex-direction: column; z-index: 100;
        }
        h1 { color: #0f0; text-shadow: 0 0 10px #0f0; font-size: 40px; margin-bottom: 10px;}
    </style>
</head>
<body>

<div id="crosshair"></div>

<div id="weapon-container">
    <img id="weapon-img" src="./weapon.png" alt="Weapon Skin">
</div>

<div id="ui-layer">–û—Å—Ç–∞–ª–æ—Å—å —à–∞—Ä–æ–≤: <span id="ball-count">0</span></div>
<div id="msg-container"></div>

<div id="start-screen">
    <h1>CS: "–ò–ù–ö–û–ì–ù–ò–¢–û" BIRTHDAY </h1>
    <p>–¶–µ–ª—å: –ó–∞–≥–æ–Ω–∏ –≤—Å–µ —à–∞—Ä—ã –≤ –ª—É–∑—ã –≤—ã—Å—Ç—Ä–µ–ª–∞–º–∏.</p>
    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: WASD - —Ö–æ–¥–∏—Ç—å, –ú—ã—à—å - —Å—Ç—Ä–µ–ª—è—Ç—å, SPACE - –ø—Ä—ã–∂–æ–∫</p>
    <br>
    <button id="start-btn">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
</div>

<div id="win-screen">
    <h1>–ë–ò–õ–¨–Ø–†–î–ò–°–¢ WIN!</h1>
    <h2 style="color: #0f0; text-shadow: 0 0 10px #0f0;">–° –î–ù–ï–ú –†–û–ñ–î–ï–ù–ò–Ø! üéâ</h2>
    <p>–í–≤–µ–¥–∏ —Å–≤–æ–π USDT (BEP20) –∫–æ—à–µ–ª–µ–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–∞—Ä–æ—á–∫–∞:</p>
    <input type="text" id="wallet-input" placeholder="0x...">
    <button id="send-btn">–ü–û–î–¢–í–ï–†–î–ò–¢–¨</button>
</div>

<script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
</script>

<script type="module">
    import * as THREE from 'three';
    import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

    // --- –ù–ê–°–¢–†–û–ô–ö–ò –î–†–£–ó–ï–ô ---
    const friends = [
        { name: "–ú–ò–®–ê", style: "background-image: url('./friends/1.png');", text: "–õ–µ—Ç—Å –≥–æ—É —Ñ–∞–ª–æ—Å" },
        { name: "–î–ò–ú–ê", style: "background-image: url('./friends/2.png');", text: "–ú–æ–ª–æ–¥–µ—Ü, –ù–∏–∫–∏—Ç–∞! –°—Ä–∞–∑—É –≤–∏–¥–Ω–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª" },
        { name: "–°–ï–†–ï–ì–ê", style: "background-image: url('./friends/3.png');", text: "–•–û–†–û–®–ò–ô –ë–´–õ" },
        { name: "–ö–ò–†–ò–õ–õ", style: "background-image: url('./friends/4.png');", text: "–ï—Å–ª–∏ –∑–∞–±—å–µ—à—å - –ø–æ–±–µ–¥–∏–ª" },
        { name: "–î–ò–ú–ê", style: "background-image: url('./friends/2.png');", text: "–ü–æ—Å–º–æ—Ç—Ä–∏–º, –≤–æ–∑–º–æ–∂–Ω–æ" },
        { name: "–ú–ò–®–ê", style: "background-image: url('./friends/1.png');", text: "–ö–ò–°–ò –ö–ò–°–ò –ú–Ø–£ –ú–Ø–£" }
    ];

    let camera, scene, renderer, controls;
    let raycaster;
    const objects = [];
    const pockets = [];
    let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false, canJump = false;
    let prevTime = performance.now();
    const velocity = new THREE.Vector3();
    const direction = new THREE.Vector3();
    const ballsData = [];

    init();
    animate();

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x111111);
        scene.fog = new THREE.Fog(0x111111, 0, 700);

        // –û—Å–≤–µ—â–µ–Ω–∏–µ
        const light = new THREE.HemisphereLight(0xeeeeff, 0x777788, 2.0);
        scene.add(light);
        const spotLight = new THREE.SpotLight(0xffffff, 1.5);
        spotLight.position.set(0, 200, 0);
        spotLight.angle = Math.PI / 4;
        spotLight.penumbra = 0.1;
        spotLight.decay = 2;
        spotLight.distance = 400;
        scene.add(spotLight);


        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.y = 12;

        controls = new PointerLockControls(camera, document.body);

        const startBtn = document.getElementById('start-btn');
        startBtn.addEventListener('click', () => {
            controls.lock();
        });
        controls.addEventListener( 'lock', function () {
            document.getElementById('start-screen').style.display = 'none';
        } );
        controls.addEventListener( 'unlock', function () {
             if (ballsData.length > 0) document.getElementById('start-screen').style.display = 'flex';
        } );

        scene.add(controls.getObject());

        // --- –°–¢–û–õ ---
        const tableGeo = new THREE.PlaneGeometry(400, 200);
        const tableMat = new THREE.MeshStandardMaterial({ color: 0x005500, roughness: 0.9, metalness: 0.1 });
        const table = new THREE.Mesh(tableGeo, tableMat);
        table.rotation.x = -Math.PI / 2;
        scene.add(table);

        const wallMat = new THREE.MeshStandardMaterial({ color: 0x2a1a12, roughness: 0.7 });
        createWall(0, 10, -105, 420, 20, 10, wallMat);
        createWall(0, 10, 105, 420, 20, 10, wallMat);
        createWall(-205, 10, 0, 10, 20, 220, wallMat);
        createWall(205, 10, 0, 10, 20, 220, wallMat);

        // --- –ü–û–õ ---
        const floorGeo = new THREE.PlaneGeometry(2000, 2000);
        const floorMat = new THREE.MeshStandardMaterial({ color: 0x0a0a0a, roughness: 0.8 });
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI / 2;
        floor.position.y = -50;
        scene.add(floor);

        // --- –õ–£–ó–´ ---
        createPocket(-190, -90); createPocket(0, -90); createPocket(190, -90);
        createPocket(-190, 90); createPocket(0, 90); createPocket(190, 90);

        // --- –®–ê–†–´ ---
        for (let i = 0; i < 8; i++) { createBall(); }
        updateBallCount();

        raycaster = new THREE.Raycaster();

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        const onKeyDown = function (event) {
            switch (event.code) {
                case 'ArrowUp': case 'KeyW': moveForward = true; break;
                case 'ArrowLeft': case 'KeyA': moveLeft = true; break;
                case 'ArrowDown': case 'KeyS': moveBackward = true; break;
                case 'ArrowRight': case 'KeyD': moveRight = true; break;
                case 'Space': if ( canJump === true ) velocity.y += 150; canJump = false; break;
            }
        };
        const onKeyUp = function (event) {
            switch (event.code) {
                case 'ArrowUp': case 'KeyW': moveForward = false; break;
                case 'ArrowLeft': case 'KeyA': moveLeft = false; break;
                case 'ArrowDown': case 'KeyS': moveBackward = false; break;
                case 'ArrowRight': case 'KeyD': moveRight = false; break;
            }
        };
        document.addEventListener('keydown', onKeyDown);
        document.addEventListener('keyup', onKeyUp);

        // –°–¢–†–ï–õ–¨–ë–ê
        document.addEventListener('mousedown', (e) => {
            if (controls.isLocked && e.button === 0) shoot();
        });

        window.addEventListener('resize', onWindowResize);
    }

    function createWall(x, y, z, w, h, d, mat) {
        const geo = new THREE.BoxGeometry(w, h, d);
        const mesh = new THREE.Mesh(geo, mat);
        mesh.position.set(x, y, z);
        scene.add(mesh);
    }

    function createPocket(x, z) {
        const geo = new THREE.CircleGeometry(14, 32);
        const mat = new THREE.MeshBasicMaterial({ color: 0x000000 });
        const mesh = new THREE.Mesh(geo, mat);
        mesh.rotation.x = -Math.PI / 2;
        mesh.position.set(x, 0.2, z);
        scene.add(mesh);
        pockets.push(mesh.position);
    }

    function createBall() {
        const radius = 6;
        const geo = new THREE.SphereGeometry(radius, 24, 24);
        const color = new THREE.Color(`hsl(${Math.random() * 360}, 100%, 50%)`);
        const mat = new THREE.MeshStandardMaterial({ color: color, roughness: 0.3, metalness: 0.2 });
        const ball = new THREE.Mesh(geo, mat);
        ball.position.set((Math.random() - 0.5) * 250, radius, (Math.random() - 0.5) * 100);
        scene.add(ball);
        objects.push(ball);
        ballsData.push({ mesh: ball, velocity: new THREE.Vector3(0, 0, 0) });
    }

    function shoot() {
        // 1. –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–¥–∞—á–∏ –æ—Ä—É–∂–∏—è
        const weaponImg = document.getElementById('weapon-img');
        weaponImg.classList.add('recoil-anim');
        // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å —á–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å –æ—Ä—É–∂–∏–µ –Ω–∞ –º–µ—Å—Ç–æ
        setTimeout(() => {
             weaponImg.classList.remove('recoil-anim');
        }, 100);


        // 2. –í—Å–ø—ã—à–∫–∞ –≤—ã—Å—Ç—Ä–µ–ª–∞ (–¥—É–ª—å–Ω–∞—è)
        const flash = document.createElement('div');
        flash.style.position = 'absolute';
        flash.style.bottom = '20%'; flash.style.right = '20%';
        flash.style.width = '100px'; flash.style.height = '100px';
        flash.style.background = 'radial-gradient(circle, rgba(255,255,0,0.8) 0%, rgba(255,100,0,0) 70%)';
        flash.style.pointerEvents = 'none'; flash.style.zIndex = '45';
        flash.style.transform = 'translate(50%, 50%)';
        document.body.appendChild(flash);
        setTimeout(() => flash.remove(), 50);

        // 3. –§–∏–∑–∏–∫–∞ –≤—ã—Å—Ç—Ä–µ–ª–∞
        raycaster.setFromCamera( new THREE.Vector2(), camera );
        const intersects = raycaster.intersectObjects( objects, false );

        if ( intersects.length > 0 ) {
            const hitBall = intersects[0].object;
            const data = ballsData.find(b => b.mesh === hitBall);
            const shootDir = intersects[0].point.sub(camera.position).normalize();
            shootDir.y = 0;
            if(data) {
                // –°–∏–ª–∞ –≤—ã—Å—Ç—Ä–µ–ª–∞
                data.velocity.add(shootDir.multiplyScalar(7));
            }
        }
    }

    function showFriendMessage() {
        if(friends.length === 0) return;
        const friendIndex = Math.floor(Math.random() * friends.length);
        const friend = friends[friendIndex];
        const el = document.createElement('div');
        el.className = 'friend-msg';
        // –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –∞–≤–∞—Ç–∞—Ä–∫–∏, –∑–∞–º–µ–Ω–∏ background-color –Ω–∞ background-image: url(...)
        el.innerHTML = `
            <div class="friend-avatar" style="background-color: ${friend.color}"></div>
            <div class="friend-text" style="color:${friend.color}">${friend.text}</div>
        `;
        document.getElementById('msg-container').appendChild(el);
        setTimeout(() => el.remove(), 3000);
    }

    function checkWin() {
        if (ballsData.length === 0) {
            controls.unlock();
            document.getElementById('win-screen').style.display = 'flex';
            document.getElementById('start-screen').remove(); // –ß—Ç–æ–±—ã –Ω–µ –≤–µ—Ä–Ω—É–ª—Å—è
        }
    }

    function updateBallCount() {
        document.getElementById('ball-count').innerText = ballsData.length;
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
        requestAnimationFrame(animate);
        const time = performance.now();
        const delta = (time - prevTime) / 1000;

        // --- –ò–ì–†–û–ö ---
        if (controls.isLocked) {
            velocity.x -= velocity.x * 10.0 * delta;
            velocity.z -= velocity.z * 10.0 * delta;
            velocity.y -= 9.8 * 100.0 * delta; // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è

            direction.z = Number(moveForward) - Number(moveBackward);
            direction.x = Number(moveRight) - Number(moveLeft);
            direction.normalize();

            if (moveForward || moveBackward) velocity.z -= direction.z * 600.0 * delta;
            if (moveLeft || moveRight) velocity.x -= direction.x * 600.0 * delta;

            controls.moveRight(-velocity.x * delta);
            controls.moveForward(-velocity.z * delta);
            controls.getObject().position.y += ( velocity.y * delta );

            if ( controls.getObject().position.y < 12 ) {
                velocity.y = 0;
                controls.getObject().position.y = 12;
                canJump = true;
            }
        }

        // --- –®–ê–†–´ ---
        for (let i = ballsData.length - 1; i >= 0; i--) {
            const b = ballsData[i];
            b.mesh.position.add(b.velocity);
            b.velocity.multiplyScalar(0.985); // –¢—Ä–µ–Ω–∏–µ

            // –ë–æ—Ä—Ç–∞
            if (b.mesh.position.x > 195 || b.mesh.position.x < -195) b.velocity.x *= -0.8;
            if (b.mesh.position.z > 95 || b.mesh.position.z < -95) b.velocity.z *= -0.8;

            // –õ—É–∑—ã
            if(b.velocity.length() > 0.1) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —à–∞—Ä –¥–≤–∏–∂–µ—Ç—Å—è
                 for (let p of pockets) {
                    if (b.mesh.position.distanceTo(p) < 16) {
                        scene.remove(b.mesh);
                        ballsData.splice(i, 1);
                        objects.splice(objects.indexOf(b.mesh), 1);
                        showFriendMessage();
                        updateBallCount();
                        checkWin();
                        break;
                    }
                }
            }
        }
        prevTime = time;
        renderer.render(scene, camera);
    }

    document.getElementById('send-btn').addEventListener('click', async () => {
        const wallet = document.getElementById('wallet-input').value;
        const btn = document.getElementById('send-btn');
        if(!wallet || wallet.length < 10) return alert('–í–≤–µ–¥–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ—à–µ–ª–µ–∫!');

        btn.innerText = '–û–¢–ü–†–ê–í–ö–ê...'; btn.disabled = true;

        try {
            const res = await fetch('/api/send-wallet', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ wallet })
            });
            if(res.ok) {
                document.getElementById('win-screen').innerHTML = '<h1>–î–ê–ù–ù–´–ï –û–¢–ü–†–ê–í–õ–ï–ù–´!</h1><h2>–ñ–¥–∏ –ø–æ–¥–∞—Ä–æ–∫ –Ω–∞ –∫–æ—à–µ–ª–µ–∫! üéÅ</h2>';
            } else { throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'); }
        } catch(e) {
            alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –°–¥–µ–ª–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç –∏ —Å–∫–∏–Ω—å –¥—Ä—É–≥—É –≤ –õ–°.');
            btn.innerText = '–ü–û–î–¢–í–ï–†–î–ò–¢–¨'; btn.disabled = false;
        }
    });
</script>
</body>
</html>